<!DOCTYPE html>
<html>

<head>
	<title>Assign-Mentor</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
		integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
</head>

<body>

	<div class="container">
		<form onsubmit="assignStudentsToMentor()">
			<div class="form-row">
				<div class="form-group col-md-6">
					<label for="inputState">Mentor</label>
					<select id="inputMentorForm1" onclick="getMentors('inputMentorForm1')" class="form-control">
						<option selected>Choose...</option>

					</select>

				</div>
				<div class="form-group col-md-4">
					<label for="exampleFormControlSelect1">Student</label>
					<select class="form-control" onclick="getUnassignedStudents()" id="inputStudentForm1">

					</select>

				</div>
				<div class="form-group col-md-2">

				</div>
			</div>

			<button type="submit" class="btn btn-primary">Assign</button>
		</form>

		<form onsubmit="changeMentorForStudent()">
			<div class="form-row">
				<div class="form-group col-md-6">
					<label for="inputState">Student</label>
					<select id="inputStudentForm2" onclick="getStudents('inputStudentForm2')" class="form-control">
						<option selected>Choose...</option>

					</select>

				</div>
				<div class="form-group col-md-4">
					<label for="inputState">Mentor</label>
					<select id="inputMentorForm2" onclick="getMentors('inputMentorForm2')" class="form-control">
						<option selected>Choose...</option>

					</select>

				</div>
				<div class="form-group col-md-2">

				</div>
			</div>

			<button type="submit" class="btn btn-primary">Assign</button>
		</form>

		<form onsubmit="getStudentsDataForMentors()">
			<div class="form-row">
				<div class="form-group col-md-6">
					<label for="inputState">Mentor</label>
					<select id="inputMentorForm3" onclick="getMentors('inputMentorForm3')" class="form-control">
						<option selected>Choose...</option>

					</select>

				</div>
				<div class="form-group col-md-4">

				</div>
				<div class="form-group col-md-2">

				</div>
			</div>

			<button type="submit" class="btn btn-primary">Show Students</button>
		</form>

		<div class="container" id="studentDataForAMentor">

		</div>

	</div>

	<script>
		async function getStudents(dropDownId) {
			
			let studetData;
			try {
				let studetFetch = await fetch("https://assign-mentor-umesh.herokuapp.com/showAllStudents");
				studetData = await studetFetch.json();

				document.getElementById(dropDownId).innerHTML = "";

				studetData.forEach((student) => {
					let op = document.createElement("option");
					op.innerHTML = student;
					
					document.getElementById(dropDownId).appendChild(op);
				});
			} catch (error) {
				console.log(error);
			}
		}

		async function getUnassignedStudents() {

			let studetData;
			try {
				let studetFetch = await fetch("https://assign-mentor-umesh.herokuapp.com/showAllUnassignedStudents");
				studetData = await studetFetch.json();

				document.getElementById("inputStudentForm2").innerHTML = "";

				studetData.forEach((student) => {
					let op = document.createElement("option");
					op.innerHTML = student;
					
					document.getElementById("inputStudentForm2").appendChild(op);
				});
			} catch (error) {
				console.log(error);
			}
		}

		async function getMentors(dropDownId) {
			
			let mentorData;
			try {
				let mentorFetch = await fetch("https://assign-mentor-umesh.herokuapp.com/showAllMentors");
				mentorData = await mentorFetch.json();

				document.getElementById(dropDownId).innerHTML = "";

				mentorData.forEach((mentor) => {
					let op = document.createElement("option");
					op.innerHTML = mentor;
					
					document.getElementById(dropDownId).appendChild(op);
				});
			} catch (error) {
				console.log(error);
			}
		}

		async function assignStudentsToMentor() {
			
			event.preventDefault();

			let el = document.getElementById("inputStudentForm1");
			let mentorName = el.options[el.selectedIndex].value;
		
			let students = [];

			await fetch("https://assign-mentor-umesh.herokuapp.com/assignStudentsToMentor", {
				method: "POST",
				body: {
					"mentorName": mentorName,
					"students": students
				},
				headers: {
					"Content-Type": "application/json",
				},
			});
			alert("Done")
		}

		async function changeMentorForStudent() {
			
			event.preventDefault();

			let el = document.getElementById("inputStudentForm2");
			let studentName = el.options[el.selectedIndex].value;

			let el1 = document.getElementById("inputMentorForm2").value;
			let newMentorName = el1.options[el1.selectedIndex].value;

			await fetch("https://assign-mentor-umesh.herokuapp.com/changeMentorForStudent", {
				method: "POST",
				body: {
					"studentName": studentName,
					"newMentorName": newMentorName
				},
				headers: {
					"Content-Type": "application/json",
				},
			});
			alert("Done")
		}

		async function getStudentsDataForMentors() {

			event.preventDefault();

			let el = document.getElementById("inputMentorForm3");
			let mentorName = el.options[el.selectedIndex].value;

			let studentsData;
			try {
				let studentsFetch = await fetch("https://assign-mentor-umesh.herokuapp.com/showAllStudentsForMentor/"+mentorName);
				studentsData = await studentsFetch.json();

				document.getElementById("studentDataForAMentor").innerHTML = "";

				studentsData.forEach((student) => {
					let op = document.createElement("p");
					op.innerHTML = student;
					document.getElementById("studentDataForAMentor").appendChild(op);
				});
			} catch (error) {
				console.log(error);
			}
		}
	</script>
</body>

</html>